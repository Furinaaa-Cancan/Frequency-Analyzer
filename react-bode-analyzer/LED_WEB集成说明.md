# Web端LED控制模块集成说明

## ✅ 已完成

Web界面现已集成**LED控制面板**，可以通过浏览器实时控制GD32开发板上的LED！

---

## 🎨 新增组件

### 文件列表
1. **`src/components/LEDControl.jsx`** - LED控制面板组件
2. **`src/styles/LEDControl.css`** - LED控制样式

### 修改文件
- **`src/App.jsx`** - 集成LED控制组件

---

## 💡 功能特性

### 1. LED模式选择
7种LED模式，一键切换：
- ⚫ **OFF** - 关闭所有LED
- 🌊 **Flow** - 流水灯效果（拖尾）
- 💨 **Breath** - 呼吸灯渐变
- ✨ **Blink** - 全部闪烁
- 🎯 **Specific** - 特定LED闪烁
- 🔄 **Rotate** - 单个轮流点亮
- 🚨 **Alarm** - 报警模式（2Hz快闪）

### 2. 亮度控制
- 滑块调节：0-100%
- 预设按钮：25%, 50%, 75%, 100%
- 实时预览当前亮度值

### 3. 间隔控制
- 滑块调节：1-5000ms（快速预览）
- 输入框：1-30000ms（精确设置）
- 预设按钮：
  - 快 100ms
  - 中 500ms
  - 慢 1s
  - 超慢 5s

### 4. 快捷操作
- 🚨 **报警模式** - 一键触发报警
- ⚫ **关闭LED** - 一键关闭所有LED

### 5. 状态显示
实时显示当前LED状态：
- 当前模式（带颜色和图标）
- 当前亮度
- 当前间隔

---

## 🚀 使用方法

### 步骤1：启动Web服务器
```bash
cd react-bode-analyzer
npm run dev
```

### 步骤2：打开浏览器
访问：`http://localhost:3000`

### 步骤3：连接串口
点击"🔌 连接串口"按钮

### 步骤4：控制LED
1. **选择模式**：点击任意模式按钮（Flow、Breath等）
2. **调节亮度**：拖动亮度滑块或点击预设值
3. **调节间隔**：拖动间隔滑块或输入具体数值
4. **快捷操作**：点击"报警模式"或"关闭LED"

---

## 📸 界面预览

### LED控制面板
```
┌────────────────────────────────────────┐
│ 💡 LED控制面板                          │
│ 实时控制LED状态指示                     │
├────────────────────────────────────────┤
│ LED模式:                                │
│ [OFF] [Flow] [Breath] [Blink]          │
│ [Specific] [Rotate] [Alarm]            │
├────────────────────────────────────────┤
│ 亮度: 100%                              │
│ ━━━━━━━━━━━━━━━●                        │
│ [25%] [50%] [75%] [100%]               │
├────────────────────────────────────────┤
│ 间隔: 1000ms                            │
│ ━━━━━━●━━━━━━━━━                        │
│ [快100ms] [中500ms] [慢1s] [超慢5s]     │
│ [输入框: 1000] [应用]                   │
├────────────────────────────────────────┤
│ [🚨 报警模式] [⚫ 关闭LED]               │
├────────────────────────────────────────┤
│ 当前模式: 🌊 Flow                       │
│ 亮度: 100%                              │
│ 间隔: 1000ms                            │
└────────────────────────────────────────┘
```

---

## 🎯 与固件端通信

### 发送的命令
Web端通过串口发送以下命令：

```
LED:0-6           设置LED模式
LED_BRIGHT:0-100  设置亮度
LED_FREQ:1-30000  设置间隔
```

### 示例通信流程
```
用户操作: 点击"Flow"按钮
Web发送: LED:1
固件回复: OK:LED_MODE:Flow
日志显示: "LED模式: Flow"

用户操作: 拖动亮度到50%
Web发送: LED_BRIGHT:50
固件回复: OK:LED_BRIGHTNESS:50%
日志显示: "LED亮度: 50%"

用户操作: 输入间隔2000ms，点击应用
Web发送: LED_FREQ:2000
固件回复: OK:LED_INTERVAL:2000ms
日志显示: "LED间隔: 2000ms"
```

---

## 🎨 界面设计亮点

### 视觉效果
- 🌈 渐变背景（深蓝色主题）
- ✨ 发光效果（模式选中时）
- 🎯 响应式设计（移动端适配）
- 💫 平滑过渡动画

### 交互体验
- 实时反馈：拖动滑块时即时显示数值
- 悬停效果：按钮悬停时高亮提示
- 禁用状态：未连接串口时按钮灰显
- 状态提示：底部实时显示当前LED状态

---

## 📊 功能对比

| 功能 | 固件端 | Web端 |
|------|-------|-------|
| LED模式切换 | ✅ 串口命令 | ✅ 按钮点击 |
| 亮度控制 | ✅ 0-100% | ✅ 滑块+预设 |
| 间隔控制 | ✅ 1-30000ms | ✅ 滑块+输入 |
| 实时预览 | ❌ 无 | ✅ 有 |
| 状态显示 | ✅ 串口输出 | ✅ 界面显示 |
| 快捷操作 | ❌ 无 | ✅ 报警/关闭 |

---

## 🔧 技术细节

### React组件结构
```jsx
<LEDControl>
  ├── 模式选择按钮组
  ├── 亮度控制（滑块+预设）
  ├── 间隔控制（滑块+输入+预设）
  ├── 快捷操作按钮
  └── 状态显示面板
</LEDControl>
```

### 状态管理
```javascript
const [ledMode, setLedMode] = useState(0)        // LED模式
const [brightness, setBrightness] = useState(100) // 亮度
const [interval, setInterval] = useState(1000)    // 间隔
```

### 串口通信
```javascript
// 发送LED命令
sendCommand(`LED:${mode}`, addLog)
sendCommand(`LED_BRIGHT:${brightness}`, addLog)
sendCommand(`LED_FREQ:${interval}`, addLog)
```

---

## 🎉 使用示例

### 示例1：测量时显示呼吸灯
```
1. 连接串口
2. 点击"Breath"按钮
3. 调整亮度到50%
4. 开始扫频测量
→ LED将以呼吸效果指示测量进行中
```

### 示例2：错误时触发报警
```
1. 发生通信错误
2. 点击"🚨 报警模式"按钮
→ 所有LED以2Hz快速闪烁，最大亮度
```

### 示例3：自定义流水灯
```
1. 点击"Flow"按钮
2. 调整间隔到300ms
3. 调整亮度到75%
→ LED以300ms间隔流水，75%亮度
```

---

## 📝 注意事项

### 1. 串口连接
- 必须先连接串口才能控制LED
- 未连接时按钮为灰色禁用状态
- 底部会显示警告提示

### 2. 参数范围
- 亮度：0-100%
- 间隔：1-30000ms（滑块最大5000ms，输入框可达30000ms）
- 模式：0-6（7种模式）

### 3. 响应时间
- 串口命令发送后，LED会立即响应
- 日志窗口会显示发送的命令和响应

### 4. 浏览器兼容性
- 需要支持Web Serial API的浏览器
- 推荐：Chrome、Edge（最新版）
- 不支持：Firefox、Safari（暂不支持Web Serial API）

---

## 🐛 故障排查

### Q1: LED控制面板不显示？
**A**: 检查是否正确导入组件：
```javascript
import LEDControl from './components/LEDControl'
```

### Q2: 按钮点击无反应？
**A**: 
1. 检查串口是否已连接（顶部状态栏应显示"已连接"）
2. 查看日志窗口是否有错误信息
3. 确认固件端已集成LED控制代码

### Q3: 亮度/间隔调整无效？
**A**: 
1. 拖动滑块后松开鼠标（会自动应用）
2. 或使用输入框输入后点击"应用"按钮
3. 查看日志确认命令是否发送

### Q4: 样式显示异常？
**A**: 确认CSS文件已正确引入：
```javascript
import '../styles/LEDControl.css'
```

---

## 🚀 下一步

### 可选增强
1. ⚪ 添加LED状态动画预览
2. ⚪ 添加自定义LED组合选择（Specific模式）
3. ⚪ 添加LED控制宏（保存常用配置）
4. ⚪ 集成到测量流程中（自动状态指示）

### 集成到测量流程示例
```javascript
// 在handleSweep函数中
const handleSweep = () => {
  // 开始扫频时：呼吸灯
  sendCommand('LED:2', addLog)       // Breath mode
  sendCommand('LED_BRIGHT:50', addLog)
  
  // 发送扫频命令
  sendCommand('SWEEP', addLog)
  
  // 扫频完成后（需要监听串口数据）
  // sendCommand('LED:0', addLog)    // OFF
}
```

---

## ✅ 集成检查清单

- [x] LEDControl组件创建
- [x] CSS样式文件创建
- [x] App.jsx导入组件
- [x] App.jsx添加到渲染树
- [x] 串口命令集成
- [x] 日志输出集成
- [x] 响应式设计
- [x] 禁用状态处理
- [x] 说明文档

---

## 🎊 总结

**Web端LED控制模块已完整集成！**

现在你可以通过浏览器：
- ✅ 可视化控制7种LED模式
- ✅ 实时调节LED亮度（0-100%）
- ✅ 灵活设置LED间隔（1-30000ms）
- ✅ 一键触发报警或关闭
- ✅ 实时查看LED状态

配合固件端的LED驱动，形成完整的LED控制系统！

**祝使用愉快！** 🚀

---

**作者**: Cascade AI  
**日期**: 2025-11-25  
**版本**: v1.0
