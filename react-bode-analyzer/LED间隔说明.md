# LED间隔时间说明

## 🔍 问题发现

用户反馈："比如1s就应该亮一下，间隔1s这种的，按钮好像不太准"

---

## 📊 固件端interval的实际含义

### 不同模式下interval的定义

查看固件代码 `firmware/BSP/LED/led.c`：

#### 1. **Blink模式（闪烁）**
```c
if(led_counter++ >= current_interval) {
    led_state = !led_state;  // 切换亮灭状态
}
```
- **interval = 切换时间（半周期）**
- 例如：`interval = 1000ms`
  - LED亮1000ms → 灭1000ms → 亮1000ms...
  - **完整周期 = 2000ms**
  - **频率 = 0.5Hz**

#### 2. **Specific模式（特定LED闪烁）**
- 同Blink模式
- **interval = 半周期**

#### 3. **Flow模式（流水灯）**
```c
if(led_counter++ >= current_interval) {
    led_index = (led_index + 1) % 5;
}
```
- **interval = 切换LED的时间**
- 例如：`interval = 1000ms`
  - 每1秒切换到下一个LED

#### 4. **Rotate模式（轮流）**
- 同Flow模式
- **interval = 切换LED的时间**

#### 5. **Breath模式（呼吸灯）**
```c
if(led_counter++ >= (current_interval / 200)) {
    breath_brightness += 2;  // 0-100-0共200步
}
```
- **interval = 整个呼吸周期**
- 例如：`interval = 1000ms`
  - 完整的亮起+暗下周期为1秒

---

## ⚠️ 用户期望 vs 实际效果

### Blink/Specific模式的问题

| 用户期望 | 用户设置 | 实际效果 | 完整周期 |
|---------|---------|---------|---------|
| 每秒闪1次 | 1000ms | 亮1s+灭1s | **2秒** ❌ |
| 每秒闪2次 | 500ms | 亮0.5s+灭0.5s | **1秒** ✓ |

### 其他模式

| 模式 | interval含义 | 符合直觉 |
|------|-------------|---------|
| Flow | 切换LED时间 | ✓ 符合 |
| Breath | 完整周期 | ✓ 符合 |
| Rotate | 切换LED时间 | ✓ 符合 |

---

## ✅ 解决方案

### 方案：调整预设值和标签

**修改预设值**，让标签显示实际频率效果：

| 预设按钮 | interval值 | Blink实际效果 | 说明 |
|---------|-----------|--------------|------|
| 快速(100ms) | 50ms | 亮50ms+灭50ms = 100ms周期 | 10Hz |
| 中速(500ms) | 250ms | 亮250ms+灭250ms = 500ms周期 | 2Hz |
| 慢速(1s) | 500ms | 亮500ms+灭500ms = 1s周期 | 1Hz |
| 很慢(2s) | 1000ms | 亮1s+灭1s = 2s周期 | 0.5Hz |
| 超慢(5s) | 2500ms | 亮2.5s+灭2.5s = 5s周期 | 0.2Hz |
| 极慢(10s) | 5000ms | 亮5s+灭5s = 10s周期 | 0.1Hz |

### 添加说明提示

在间隔标签旁边添加小字说明：
```
间隔: 500ms （闪烁模式：完整周期为2倍）
```

---

## 📊 对比示例

### 修改前
```
用户点击：[1s]按钮
发送命令：LED_FREQ:1000
实际效果：LED每2秒闪一次 ❌
用户困惑："不对啊，怎么这么慢？"
```

### 修改后
```
用户点击：[慢速(1s)]按钮
发送命令：LED_FREQ:500
实际效果：LED每1秒闪一次 ✓
用户满意："对了，这才是1秒一次！"
```

---

## 🎯 各模式使用建议

### Blink模式（全部闪烁）
- 想要"每秒闪1次" → 点击 **[慢速(1s)]** → 发送500ms
- 想要"每秒闪2次" → 点击 **[中速(500ms)]** → 发送250ms
- 想要"快速闪烁" → 点击 **[快速(100ms)]** → 发送50ms

### Flow模式（流水灯）
- 快速流动 → 点击 **[快速(100ms)]** → 每100ms切换LED
- 慢速流动 → 点击 **[慢速(1s)]** → 每1秒切换LED

### Breath模式（呼吸灯）
- 快速呼吸 → 点击 **[慢速(1s)]** → 1秒完成一个呼吸周期
- 缓慢呼吸 → 点击 **[超慢(5s)]** → 5秒完成一个呼吸周期

### Rotate模式（轮流点亮）
- 同Flow模式

---

## 🔢 精确计算

### 如果用户想要精确的闪烁频率

**公式**：`interval = (1000 / 频率) / 2`

| 期望频率 | 计算 | interval设置 |
|---------|------|-------------|
| 0.5Hz (2秒一次) | (1000/0.5)/2 | 1000ms |
| 1Hz (1秒一次) | (1000/1)/2 | 500ms |
| 2Hz (0.5秒一次) | (1000/2)/2 | 250ms |
| 4Hz (0.25秒一次) | (1000/4)/2 | 125ms |
| 10Hz (0.1秒一次) | (1000/10)/2 | 50ms |

### 示例

用户想要"每3秒闪一次"：
```
频率 = 1/3 Hz = 0.33Hz
interval = (1000 / 0.33) / 2 ≈ 1500ms

操作：在输入框输入 1500，点击"应用"
```

---

## 📝 界面更新

### 新的预设按钮显示
```
间隔: 500ms （闪烁模式：完整周期为2倍）
━━━━━━━●━━━━━━━━━━━━
1ms  100ms  1s  10s  30s

[快速(100ms)] [中速(500ms)] [慢速(1s)]
[很慢(2s)] [超慢(5s)] [极慢(10s)]

[输入框: 500] [应用]
```

### 说明文字样式
- 小字号（11px）
- 灰色（#9d8e7a）
- 斜体
- 不影响主要信息

---

## 🎉 总结

### 问题根源
- 固件中Blink模式的`interval`是**半周期**（切换时间）
- 用户期望的是**完整周期**（闪一次的时间）

### 解决方法
- ✅ 调整预设值：标签显示实际效果
- ✅ 添加提示：告知用户闪烁模式的特殊性
- ✅ 保持灵活：输入框可精确设置

### 效果
- 用户点击"慢速(1s)" → LED每秒闪一次 ✓
- 用户点击"快速(100ms)" → LED每0.1秒闪一次 ✓
- 直观、准确、易用！

---

**更新时间**: 2025-11-25  
**版本**: v1.2  
**修复**: Blink模式interval标签
