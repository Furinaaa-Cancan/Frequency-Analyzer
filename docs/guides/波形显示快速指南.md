# 🎯 波形实时显示 - 快速使用指南

## 🚀 快速开始

### 1. 重新编译固件
```bash
# 使用Keil或IAR重新编译并烧录固件
# 固件已更新：自动发送波形数据
```

### 2. 启动Web应用
```bash
cd react-bode-analyzer
npm run dev
```

### 3. 测试波形显示

#### 方法A：单频测试（立即显示）
1. 连接串口
2. 输入命令：`MEASURE`
3. 波形图立即显示输入/输出信号

#### 方法B：扫频测试（自动显示）
1. 连接串口
2. 点击"开始扫频"按钮或输入 `SWEEP`
3. 在100Hz, 200Hz, ..., 1000Hz时自动更新波形

## 📊 波形显示位置

Web界面布局（从上到下）：
```
1. 控制面板
2. 状态栏
3. 统计信息
4. 公式说明
5. ⭐ 波形显示区 ⭐  <-- 新增！
6. Bode图
7. 数据表格
8. 日志窗口
```

## 🎨 显示内容

### 波形图表
- **蓝色曲线**：输入信号（PA6）
- **红色曲线**：输出信号（PB1）
- **X轴**：时间（毫秒）
- **Y轴**：ADC值（0-4095）

### 统计信息卡片
1. **输入信号**（蓝色边框）
   - 峰峰值、最大值、最小值

2. **输出信号**（红色边框）
   - 峰峰值、最大值、最小值

3. **幅值比**（黑色边框）
   - H = 输出峰峰值 / 输入峰峰值

## 🔍 验证是否工作

### 检查清单
- ✅ Web界面出现"📊 实时信号波形"区域
- ✅ 执行MEASURE后，波形区显示曲线
- ✅ 扫频时，每100Hz波形更新一次
- ✅ 蓝色和红色曲线有明显相位差

### 预期效果
- **100Hz**: 相位差约 -45°，波形有明显错位
- **500Hz**: 相位差约 -70°，输出幅度衰减明显
- **1000Hz**: 相位差约 -85°，输出幅度进一步衰减

## 🛠️ 技术细节

### 数据传输
```
固件发送格式：
WAVEFORM:freq,sampleRate,input1,input2,...|output1,output2,...

示例（100Hz）：
WAVEFORM:100,10000,2048,2156,2264,...|2048,1934,1856,...
        │    │      └─ 输入数据    └─ 输出数据
        │    └─ 采样率10kHz
        └─ 测试频率
```

### 数据量控制
- **原始采样**：512个点 @ 10kHz
- **实际传输**：64个点（每8个取1个）
- **扫频策略**：只在100Hz倍数发送（10个波形/次扫频）

## ⚠️ 常见问题

### Q1: 看不到波形显示区？
**解决方案：**
- 检查Web应用是否重新启动
- 刷新浏览器页面（Ctrl+R）
- 检查浏览器控制台是否有错误

### Q2: 波形显示"等待信号数据"？
**解决方案：**
- 先连接串口
- 执行 `MEASURE` 或 `SWEEP` 命令
- 等待1-2秒数据传输

### Q3: 波形显示异常（全为0或平直线）？
**解决方案：**
- 检查PA6和PB1是否正确连接
- 执行 `DEBUG` 命令检查信号源
- 确认DDS正在输出信号

### Q4: 扫频时波形不更新？
**说明：**
- 正常现象！扫频只在100Hz倍数发送波形
- 观察日志窗口，确认收到 `WAVEFORM:` 数据

### Q5: 波形数据太密集看不清？
**操作：**
- 鼠标滚轮缩放图表
- 点击图例隐藏某条曲线
- 拖动鼠标平移查看

## 🎓 教学演示建议

### 演示流程
1. **连接硬件**
   - 展示PA6和PB1的物理连接
   - 说明信号流向

2. **单频测试**
   - 设置100Hz：`FREQ:100`
   - 执行测量：`MEASURE`
   - 观察波形相位差约-45°

3. **改变频率**
   - 设置500Hz：`FREQ:500`
   - 再次测量
   - 观察相位差增大、幅度衰减

4. **完整扫频**
   - 执行：`SWEEP`
   - 观察波形在不同频率下的变化
   - 对比Bode图和波形显示

### 重点说明
- **时域 vs 频域**：波形是时域，Bode图是频域
- **相位关系**：波形错位 = 相位差
- **幅度关系**：波形高度比 = 增益
- **RC滤波效果**：高频衰减、相位滞后

## 📸 示例截图说明

### 理想波形特征
```
低频（100Hz）:
- 输入输出幅度相近
- 相位差约-45°
- 波形清晰规整

高频（1000Hz）:
- 输出幅度明显减小
- 相位差约-85°
- 输出接近-90°相移
```

## 🔧 故障排查

### 如果波形完全不显示：

1. **检查固件是否更新**
   ```bash
   # 串口终端应该看到 WAVEFORM: 开头的行
   ```

2. **检查React代码**
   ```bash
   # 确认WaveformDisplay组件已导入
   grep -r "WaveformDisplay" src/App.jsx
   ```

3. **查看浏览器控制台**
   - 打开F12开发者工具
   - 查看Console标签
   - 检查是否有JavaScript错误

4. **验证数据流**
   - 打开串口监视器
   - 执行MEASURE
   - 确认看到 `WAVEFORM:100,10000,...` 字样

## 📝 修改总结

### 固件修改（main.c）
1. ✅ ProcessADCData函数：添加波形数据输出
2. ✅ AutoSweep函数：在关键频率点输出波形

### Web应用修改
1. ✅ App.jsx：导入并使用WaveformDisplay组件
2. ✅ useDataPoints.js：已支持波形数据解析
3. ✅ WaveformDisplay.jsx：已存在，无需修改

### 数据格式
```javascript
// 固件输出
WAVEFORM:100,10000,2048,2100,2150,...|2048,2000,1950,...

// React解析为
{
  freq: 100,
  sampleRate: 10000,
  input: [2048, 2100, 2150, ...],
  output: [2048, 2000, 1950, ...]
}
```

## 🎉 完成！

现在您的伯德图分析仪不仅能显示频域特性（Bode图），还能实时显示时域波形！

**下一步建议：**
- 📊 对比不同频率的波形变化
- 📈 验证Bode图数据的准确性
- 🎓 用于教学演示时域/频域关系
- 🔬 分析被测电路的时域响应

---

**版本**: v5.0 + 波形显示  
**更新**: 2025-11-02  
**状态**: ✅ 完成并测试通过








