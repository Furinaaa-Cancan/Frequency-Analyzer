# 📋 校准功能快速测试指南

## 🚀 快速测试步骤

### Step 1: 编译并烧录固件
```bash
# 使用Keil MDK打开项目
# 文件: firmware/Tamlate.uvprojx
# 编译并烧录到GD32F103
```

### Step 2: 启动Web前端
```bash
cd react-bode-analyzer
npm install  # 首次运行
npm run dev  # 启动开发服务器
# 浏览器打开: http://localhost:5173
```

### Step 3: 硬件校准连接
```
🔧 校准测试连接：
   PA6 ───短线───> PB0
   
⚠️ 断开所有被测电路（DUT）
```

### Step 4: 执行校准
1. 前端点击 **"连接串口"**
2. 点击 **"🔧 开始校准"**
3. 确认对话框
4. 等待2-3分钟

**预期输出（串口）：**
```
OK:CALIBRATION_START
CALIB_DATA:10,1.0234,-5.23
CALIB_DATA:20,1.0456,-8.45
...
CALIB_DATA:1000,2.9677,-15.64
OK:CALIBRATION_COMPLETE
```

**预期显示（前端）：**
- ✓ 校准已启用（绿色指示器）
- 图表显示100个校准数据点

### Step 5: 测量被测电路
```
🔌 测量连接：
   PA6 → [DUT输入]
   [DUT输出] → PB0
```

1. 点击 **"📊 开始扫描"**
2. 观察图表显示两条曲线：
   - 灰色虚线 = 原始数据
   - 实线 = 校准后数据

---

## ✅ 验证校准效果

### 测试1: 直通验证
```
连接：PA6 → PB0（校准后再次直通）
预期：H ≈ 1.0±0.05，θ ≈ 0°±2°
```

### 测试2: 高频对比
```
未校准时（1000Hz）：
  H_raw = 3.0（虚假高增益）
  
校准后（1000Hz）：
  H_calibrated = 1.8（真实值）
  
差异：67% 校正！
```

---

## 📊 测试数据记录

### 校准数据检查表

| 频率 | H_calib (预期) | 实际测量 | θ_calib (预期) | 实际测量 | 通过？ |
|------|---------------|----------|----------------|----------|--------|
| 10Hz | 0.9~1.1 | _____ | -10°~+10° | _____ | ☐ |
| 100Hz | 0.95~1.05 | _____ | -5°~+5° | _____ | ☐ |
| 500Hz | 1.0~1.2 | _____ | -20°~0° | _____ | ☐ |
| 1000Hz | 1.5~3.0 | _____ | -30°~0° | _____ | ☐ |

### 测量结果对比

**测试电路**：PA6 → U1B → 第三级运放 → PB1

| 频率 | H_raw | H_calibrated | 校正量 | 备注 |
|------|-------|--------------|--------|------|
| 100Hz | _____ | _____ | _____ | 低频基准 |
| 500Hz | _____ | _____ | _____ | 中频 |
| 1000Hz | _____ | _____ | _____ | 高频（关键）|

---

## 🐛 故障排查

### 问题1: 校准失败
```
[ERROR] CALIB_FAIL:xxx,signal_weak
```
**解决**：
- 检查PA6 → PB0连接
- 确保DAC5311正常工作
- 运行DEBUG命令检查TIMER2

### 问题2: 校准数据异常
```
CALIB_DATA:100,5.2345,150.23  ← 异常！
```
**解决**：
- 重启设备
- 检查运放供电
- 确认信号路径

### 问题3: 前端未显示校准状态
**解决**：
- 检查串口数据：应包含`OK:CALIBRATION_COMPLETE`
- 刷新页面
- 检查浏览器控制台错误

---

## 📝 测试清单

### 固件功能
- [ ] 串口命令`CALIBRATE`响应
- [ ] 校准扫频100个频点完成
- [ ] 输出`CALIB_DATA`格式正确
- [ ] 输出`OK:CALIBRATION_COMPLETE`
- [ ] 后续`SWEEP`输出7字段数据

### 前端功能
- [ ] 校准按钮可点击
- [ ] 显示确认对话框
- [ ] 校准过程中显示进度
- [ ] 完成后显示绿色指示器
- [ ] 图表显示双曲线对比
- [ ] 日志显示`[已校准]`标记

### 数据验证
- [ ] 校准数据在合理范围
- [ ] 校准后H值接近1.0
- [ ] 高频增益修正明显
- [ ] 相位数据连续无跳变

---

## 🎯 性能指标

### 校准精度目标
- **增益误差**：< ±5%（100-1000Hz）
- **相位误差**：< ±5°（100-1000Hz）
- **校准时间**：< 3分钟（100点）

### 测量精度提升
- **未校准**：高频误差>50%
- **校准后**：全频段误差<10%

---

## 📞 测试报告模板

```
============================================
伯德图分析仪 - 校准功能测试报告
============================================

测试日期：___________
固件版本：v5.0
硬件版本：___________
测试人员：___________

【校准测试】
□ 校准命令响应：正常 / 异常
□ 校准数据采集：正常 / 异常
□ 校准完成提示：正常 / 异常
□ 前端状态显示：正常 / 异常

【数据验证】
□ 直通测试H值：_____ (预期≈1.0)
□ 直通测试θ值：_____ (预期≈0°)
□ 高频校正效果：显著 / 轻微 / 无效

【图表显示】
□ 双曲线对比：正常 / 异常
□ 校准指示器：正常 / 异常
□ 数据日志标记：正常 / 异常

【问题记录】
1. _________________________________
2. _________________________________
3. _________________________________

【结论】
□ 通过：校准功能正常工作
□ 需改进：_______________________
□ 失败：_________________________

============================================
```

---

## 💡 提示

1. **首次测试**建议先运行`DEBUG`命令，确认系统基本功能正常
2. **校准前**确保信号输出稳定（PB1有正弦波输出）
3. **测量时**注意观察串口日志，异常数据会有警告
4. **对比图表**时注意灰色虚线（原始）和实线（校准后）的差异

---

**测试时间估计**：15-20分钟  
**成功标志**：校准后高频H值显著降低，接近真实电路特性












