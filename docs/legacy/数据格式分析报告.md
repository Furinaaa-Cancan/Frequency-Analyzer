# æ•°æ®æ ¼å¼åˆ†ææŠ¥å‘Š

## ğŸ“Š å›ºä»¶å‘é€çš„æ•°æ®æ ¼å¼

### **FREQ_RESPæ•°æ®åŒ…æ ¼å¼**

```
FREQ_RESP:freq,K,K1,H,theta
```

### **å®é™…printfè¯­å¥**

```c
printf("FREQ_RESP:%d,%d.%02d,%d.%02d,%d.%04d,%s%d.%02d\r\n", 
       freq,                                          // é¢‘ç‡
       voltage_ch1_mv/100, voltage_ch1_mv%100,        // K (è¾“å…¥å¹…åº¦)
       voltage_ch2_mv/100, voltage_ch2_mv%100,        // Kâ‚ (è¾“å‡ºå¹…åº¦)
       H_x10000/10000, H_x10000%10000,                // H(Ï‰) å¹…é¢‘å“åº”
       (phase_x100<0)?"-":"", abs(phase_x100/100), abs(phase_x100%100)  // Î¸(Ï‰) ç›¸é¢‘å“åº”
);
```

---

## ğŸ”¢ æ•°æ®ç±»å‹åˆ†æ

### **1. æ•°æ®ç±»å‹ï¼šå…¨éƒ¨æ˜¯æ•´æ•°ï¼**

**å›ºä»¶å†…éƒ¨å˜é‡**ï¼š
```c
uint32_t freq;            // é¢‘ç‡ï¼Œæ•´æ•°ï¼ˆHzï¼‰
uint32_t voltage_ch1_mv;  // ç”µå‹Ã—100ï¼ˆå•ä½ï¼šmVï¼Œæ”¾å¤§100å€å­˜å‚¨ï¼‰
uint32_t voltage_ch2_mv;  // ç”µå‹Ã—100ï¼ˆå•ä½ï¼šmVï¼Œæ”¾å¤§100å€å­˜å‚¨ï¼‰
uint32_t H_x10000;        // H(Ï‰)Ã—10000ï¼ˆæ”¾å¤§10000å€å­˜å‚¨ï¼‰
int32_t phase_x100;       // Î¸(Ï‰)Ã—100ï¼ˆæ”¾å¤§100å€å­˜å‚¨ï¼Œå¸¦ç¬¦å·ï¼‰
```

**ä¸ºä»€ä¹ˆç”¨æ•´æ•°ï¼Ÿ**
- âœ… åµŒå…¥å¼ç³»ç»Ÿæµ®ç‚¹è¿ç®—æ…¢
- âœ… é¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜
- âœ… èŠ‚çœå†…å­˜å’ŒCPUèµ„æº
- âœ… é€šè¿‡æ•´æ•°é™¤æ³•æ¨¡æ‹Ÿå°æ•°ç‚¹

---

## ğŸ“ ç²¾åº¦åˆ†æ

### **å„å‚æ•°çš„ç²¾åº¦**

| å‚æ•° | å†…éƒ¨å­˜å‚¨ | å‘é€æ ¼å¼ | ç²¾åº¦ | ç¤ºä¾‹å€¼ | å®é™…å«ä¹‰ |
|------|---------|---------|------|--------|----------|
| **é¢‘ç‡** | `uint32_t freq` | `%d` | 1 Hz | `200` | 200 Hz |
| **K (è¾“å…¥)** | `voltage_ch1_mv` (Ã—100) | `%d.%02d` | 0.01 V | `0.21` | 0.21 V |
| **Kâ‚ (è¾“å‡º)** | `voltage_ch2_mv` (Ã—100) | `%d.%02d` | 0.01 V | `0.40` | 0.40 V |
| **H(Ï‰)** | `H_x10000` (Ã—10000) | `%d.%04d` | 0.0001 | `1.9000` | 1.9000 |
| **Î¸(Ï‰)** | `phase_x100` (Ã—100) | `%s%d.%02d` | 0.01Â° | `-45.50` | -45.50Â° |

---

## ğŸ’¾ æ•°æ®ä½æ•°

### **1. é¢‘ç‡ (freq)**
```c
uint32_t freq = 200;  // 32ä½æ— ç¬¦å·æ•´æ•°
printf("%d", freq);   // è¾“å‡º: 200
```
- **æ•°æ®ç±»å‹**: 32ä½æ— ç¬¦å·æ•´æ•°
- **èŒƒå›´**: 0 ~ 4,294,967,295
- **å®é™…èŒƒå›´**: 10 ~ 1000 Hz
- **ç²¾åº¦**: 1 Hz

---

### **2. ç”µå‹Kå’ŒKâ‚ (voltage_ch1_mv, voltage_ch2_mv)**
```c
uint32_t voltage_ch1_mv = 21;  // å®é™…å­˜å‚¨çš„æ˜¯21 (ä»£è¡¨0.21V)
printf("%d.%02d", voltage_ch1_mv/100, voltage_ch1_mv%100);  
// è¾“å‡º: 0.21
```

**è®¡ç®—è¿‡ç¨‹**ï¼š
```c
// 1. ADCé‡‡æ ·
uint16_t pp_ch1 = 256;  // 12ä½ADCï¼Œå³°å³°å€¼

// 2. è½¬æ¢ä¸ºç”µå‹ï¼ˆmVï¼Œå³°å³°å€¼ï¼‰
voltage_ch1_mv = (pp_ch1 * 3300) / 4096;
// = (256 * 3300) / 4096 = 206 (mV)

// 3. è¾“å‡ºæ—¶æ ¼å¼åŒ–
printf("%d.%02d", voltage_ch1_mv/100, voltage_ch1_mv%100);
// = 2.06 (V)
```

- **æ•°æ®ç±»å‹**: 32ä½æ— ç¬¦å·æ•´æ•°
- **å†…éƒ¨å•ä½**: mV (æ¯«ä¼)
- **æ˜¾ç¤ºç²¾åº¦**: 0.01 V (10 mV)
- **å®é™…ç²¾åº¦**: å—ADCé™åˆ¶ (3.3V/4096 â‰ˆ 0.8mV)

---

### **3. å¢ç›ŠH(Ï‰) (H_x10000)**
```c
uint32_t H_x10000 = 19000;  // å®é™…å­˜å‚¨çš„æ˜¯19000 (ä»£è¡¨1.9000)
printf("%d.%04d", H_x10000/10000, H_x10000%10000);
// è¾“å‡º: 1.9000
```

**è®¡ç®—è¿‡ç¨‹**ï¼š
```c
// 1. è®¡ç®—å¢ç›Šæ¯”ï¼ˆæ”¾å¤§10000å€ï¼‰
H_x10000 = (pp_ch2 * 10000) / pp_ch1;
// = (491 * 10000) / 256 = 19179

// 2. è¾“å‡ºæ—¶æ ¼å¼åŒ–
printf("%d.%04d", H_x10000/10000, H_x10000%10000);
// = 1.9179
```

- **æ•°æ®ç±»å‹**: 32ä½æ— ç¬¦å·æ•´æ•°
- **æ”¾å¤§å€æ•°**: Ã—10000
- **æ˜¾ç¤ºç²¾åº¦**: 0.0001 (ä¸‡åˆ†ä¹‹ä¸€)
- **èŒƒå›´**: 0.0000 ~ 429,496.7295

---

### **4. ç›¸ä½Î¸(Ï‰) (phase_x100)**
```c
int32_t phase_x100 = -4550;  // å®é™…å­˜å‚¨çš„æ˜¯-4550 (ä»£è¡¨-45.50Â°)
printf("%s%d.%02d", (phase_x100<0)?"-":"", abs(phase_x100/100), abs(phase_x100%100));
// è¾“å‡º: -45.50
```

**è®¡ç®—è¿‡ç¨‹**ï¼š
```c
// 1. DFTç®—æ³•è®¡ç®—ç›¸ä½ï¼ˆå¼§åº¦ï¼‰
float phase_rad = atan2f(sin_sum2, cos_sum2) - atan2f(sin_sum1, cos_sum1);

// 2. è½¬æ¢ä¸ºåº¦Ã—100
int32_t phase_x100 = (int32_t)(phase_rad * 18000.0f / PI);
// = -0.7941 * 5729.58 = -4550

// 3. è¾“å‡ºæ—¶æ ¼å¼åŒ–
printf("%s%d.%02d", (phase_x100<0)?"-":"", abs(phase_x100/100), abs(phase_x100%100));
// = -45.50
```

- **æ•°æ®ç±»å‹**: 32ä½æœ‰ç¬¦å·æ•´æ•°
- **æ”¾å¤§å€æ•°**: Ã—100
- **æ˜¾ç¤ºç²¾åº¦**: 0.01Â° (ç™¾åˆ†ä¹‹ä¸€åº¦)
- **èŒƒå›´**: -180.00Â° ~ +180.00Â°

---

## ğŸ”„ å‰ç«¯è§£æ

### **å‰ç«¯å¦‚ä½•è§£æï¼Ÿ**

```javascript
// æ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²ï¼š
// "FREQ_RESP:200,0.21,0.40,1.9000,-45.50"

const parts = data.substring(10).split(',');  // å»æ‰"FREQ_RESP:"

const freq = parseInt(parts[0]);              // 200 (æ•´æ•°)
const K = parseFloat(parts[1]);               // 0.21 (æµ®ç‚¹)
const K1 = parseFloat(parts[2]);              // 0.40 (æµ®ç‚¹)
const H = parseFloat(parts[3]);               // 1.9000 (æµ®ç‚¹)
const theta = parseFloat(parts[4]);           // -45.50 (æµ®ç‚¹)
```

**å‰ç«¯è½¬æ¢åçš„æ•°æ®ç±»å‹**ï¼š
- å…¨éƒ¨è½¬æ¢ä¸ºJavaScriptçš„`Number`ç±»å‹ï¼ˆ64ä½æµ®ç‚¹æ•°ï¼‰
- ç²¾åº¦ï¼šIEEE 754åŒç²¾åº¦æµ®ç‚¹æ•°
- æœ‰æ•ˆæ•°å­—ï¼šçº¦15-17ä½

---

## ğŸ¯ å…³é”®å‘ç°

### **1. å›ºä»¶å‘é€çš„æ˜¯"ä¼ªæµ®ç‚¹æ•°"**
```
å®é™…ï¼šå…¨éƒ¨æ˜¯æ•´æ•°è¿ç®—
ä¼ è¾“ï¼šæ ¼å¼åŒ–ä¸º"æ•´æ•°.å°æ•°"å­—ç¬¦ä¸²
æ¥æ”¶ï¼šå‰ç«¯è§£æä¸ºæµ®ç‚¹æ•°
```

### **2. ç²¾åº¦é™åˆ¶**
- **ç”µå‹K/Kâ‚**: 0.01Vç²¾åº¦ï¼ˆå—ADC 12ä½é™åˆ¶ï¼Œå®é™…æ›´é«˜ï¼‰
- **å¢ç›ŠH(Ï‰)**: 0.0001ç²¾åº¦ï¼ˆéå¸¸é«˜ï¼ï¼‰
- **ç›¸ä½Î¸(Ï‰)**: 0.01Â°ç²¾åº¦ï¼ˆè¶³å¤Ÿï¼‰

### **3. æ•°æ®ä¸€è‡´æ€§**
```c
// å›ºä»¶è®¡ç®—ï¼š
H_x10000 = (pp_ch2 * 10000) / pp_ch1;
// = (491 * 10000) / 256 = 19179

// å‰ç«¯æ˜¾ç¤ºï¼š
H = 1.9179

// éªŒè¯ï¼š
K1 / K = 0.40 / 0.21 = 1.9048  â† æ¥è¿‘ï¼
```

**å·®å¼‚åŸå› **ï¼š
- å›ºä»¶ä½¿ç”¨æ•´æ•°é™¤æ³•
- å‰ç«¯ä½¿ç”¨æµ®ç‚¹é™¤æ³•
- èˆå…¥è¯¯å·®ä¸åŒ

---

## âœ… ç»“è®º

### **æ•°æ®æ ¼å¼æ€»ç»“**

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å›ºä»¶å†…éƒ¨** | å…¨éƒ¨ä½¿ç”¨æ•´æ•°è¿ç®— |
| **ä¼ è¾“æ ¼å¼** | å­—ç¬¦ä¸²å½¢å¼çš„"ä¼ªæµ®ç‚¹æ•°" |
| **å‰ç«¯è§£æ** | è½¬æ¢ä¸ºJavaScriptæµ®ç‚¹æ•° |
| **æ€»ä½“ç²¾åº¦** | H(Ï‰)ç²¾åº¦0.0001ï¼Œéå¸¸é«˜ |
| **æ•°æ®ä¸€è‡´æ€§** | å›ºä»¶å’Œå‰ç«¯è®¡ç®—åŸºæœ¬ä¸€è‡´ |

### **è®¾è®¡ä¼˜ç‚¹**

1. âœ… **é«˜æ•ˆ**ï¼šæ•´æ•°è¿ç®—æ¯”æµ®ç‚¹å¿«
2. âœ… **ç²¾ç¡®**ï¼šé¿å…æµ®ç‚¹èˆå…¥è¯¯å·®
3. âœ… **é€šç”¨**ï¼šå­—ç¬¦ä¸²ä¼ è¾“å…¼å®¹æ€§å¥½
4. âœ… **é«˜ç²¾åº¦**ï¼šH(Ï‰)è¾¾åˆ°0.0001ç²¾åº¦

### **æ½œåœ¨é—®é¢˜**

1. âš ï¸ æ•´æ•°é™¤æ³•å¯èƒ½æœ‰èˆå…¥è¯¯å·®
2. âš ï¸ æ ¼å¼åŒ–å­—ç¬¦ä¸²å ç”¨å¸¦å®½

ä½†å¯¹äº10Hz-1kHzçš„é¢‘å“æµ‹è¯•ï¼Œè¿™ä¸ªç²¾åº¦å®Œå…¨è¶³å¤Ÿï¼

---

## ğŸ“Œ å›ç­”ç”¨æˆ·çš„é—®é¢˜

### **Q1: æ•°æ®æ˜¯å¤šå°‘ä½çš„ï¼Ÿ**
- **å†…éƒ¨å­˜å‚¨**ï¼š32ä½æ•´æ•° (uint32_t / int32_t)
- **ä¼ è¾“æ ¼å¼**ï¼šå­—ç¬¦ä¸²ï¼ˆASCIIï¼‰
- **å‰ç«¯ä½¿ç”¨**ï¼š64ä½æµ®ç‚¹æ•° (JavaScript Number)

### **Q2: æ˜¯æ•´æ•°è¿˜æ˜¯æµ®ç‚¹æ•°ï¼Ÿ**
- **å›ºä»¶ç«¯**ï¼šæ•´æ•°è¿ç®—ï¼ˆé€šè¿‡æ”¾å¤§å€æ•°æ¨¡æ‹Ÿå°æ•°ç‚¹ï¼‰
- **ä¼ è¾“ç«¯**ï¼šå­—ç¬¦ä¸²ï¼ˆçœ‹èµ·æ¥åƒæµ®ç‚¹æ•°ï¼‰
- **å‰ç«¯ç«¯**ï¼šæµ®ç‚¹æ•°ï¼ˆparseFloatè½¬æ¢ï¼‰

### **æ€»ç»“**ï¼š
**å›ºä»¶ç”¨æ•´æ•°è®¡ç®—ï¼Œæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ä¼ è¾“ï¼Œå‰ç«¯è§£æä¸ºæµ®ç‚¹æ•°ã€‚**
**æ•´ä¸ªç³»ç»Ÿçš„ç²¾åº¦è¶³å¤Ÿé«˜ï¼ŒH(Ï‰)ç²¾ç¡®åˆ°0.0001ï¼**












